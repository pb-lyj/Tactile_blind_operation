# Feature-MLPè®­ç»ƒç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†åŸºäºé¢„è®­ç»ƒè§¦è§‰ç‰¹å¾çš„Feature-MLPæ¨¡å‹è®­ç»ƒï¼Œä½¿ç”¨wandbè¿›è¡Œå®éªŒè·Ÿè¸ªå’Œå¯è§†åŒ–ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
â”œâ”€â”€ policy_learn/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ feature_mlp_new.py          # Feature-MLPæ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ training/
â”‚   â”‚   â””â”€â”€ train_feature_mlp_new.py    # è®­ç»ƒè„šæœ¬ï¼ˆæ”¯æŒwandbï¼‰
â”‚   â””â”€â”€ dataset_dataloader/
â”‚       â””â”€â”€ flexible_policy_dataset.py  # çµæ´»æ•°æ®é›†åŠ è½½å™¨
â”œâ”€â”€ run_feature_mlp_training.py         # å®Œæ•´è®­ç»ƒå¯åŠ¨è„šæœ¬
â”œâ”€â”€ run_test_training.py                # å°è§„æ¨¡æµ‹è¯•è®­ç»ƒè„šæœ¬  
â”œâ”€â”€ test_wandb_login.py                 # wandbç™»å½•æµ‹è¯•è„šæœ¬
â””â”€â”€ test_basic_functionality.py        # åŸºæœ¬åŠŸèƒ½æµ‹è¯•ï¼ˆæ— wandbï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´»condaç¯å¢ƒ
conda activate data_ans

# å®‰è£…wandbï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
pip install wandb

# ç™»å½•wandb
wandb login
```

### 2. æµ‹è¯•wandbé…ç½®

```bash
python test_wandb_login.py
```

### 3. è¿è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•

```bash
python test_basic_functionality.py
```

### 4. è¿è¡Œå°è§„æ¨¡æµ‹è¯•è®­ç»ƒ

```bash
python run_test_training.py
```

### 5. è¿è¡Œå®Œæ•´è®­ç»ƒ

```bash
python run_feature_mlp_training.py
```

## âš™ï¸ é…ç½®è¯´æ˜

è®­ç»ƒé…ç½®åŒ…å«ä»¥ä¸‹ä¸»è¦éƒ¨åˆ†ï¼š

### æ•°æ®é…ç½®
```python
'data': {
    'data_root': 'datasets/data25.7_aligned',  # æ•°æ®é›†è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
    'categories': [...],                       # è¦è®­ç»ƒçš„æ•°æ®ç±»åˆ«
    'batch_size': 32,                         # æ‰¹æ¬¡å¤§å°
    'normalize_config': {                     # å½’ä¸€åŒ–é…ç½®
        'forces': 'zscore',                   # è§¦è§‰åŠ›æ•°æ®æ ‡å‡†åŒ–
        'actions': 'minmax'                   # åŠ¨ä½œæ•°æ®å½’ä¸€åŒ–åˆ°[-1,1]
    }
}
```

### æ¨¡å‹é…ç½®
```python
'model': {
    'feature_dim': 128,                                           # å•æ‰‹ç‰¹å¾ç»´åº¦
    'action_dim': 3,                                             # è¾“å‡ºåŠ¨ä½œç»´åº¦ (dx, dy, dz)
    'hidden_dims': [512, 512, 512],                             # MLPéšè—å±‚
    'pretrained_encoder_path': 'tactile_representation/...'      # é¢„è®­ç»ƒæƒé‡è·¯å¾„
}
```

### è®­ç»ƒé…ç½®
```python
'training': {
    'epochs': 100,        # æœ€å¤§è®­ç»ƒè½®æ•°
    'lr': 1e-4,          # å­¦ä¹ ç‡
    'eval_every': 5,     # éªŒè¯é¢‘ç‡
    'patience': 15       # æ—©åœè€å¿ƒå€¼
}
```

### wandbé…ç½®
```python
'wandb': {
    'project': 'tactile-feature-mlp',                    # wandbé¡¹ç›®å
    'entity': 'your-team-name',                          # æ‚¨çš„wandbç”¨æˆ·åæˆ–å›¢é˜Ÿå
    'tags': ['feature-mlp', 'tactile', 'behavior-cloning'] # æ ‡ç­¾
}
```

## ğŸ“Š è®­ç»ƒè¾“å‡º

### æ–‡ä»¶è¾“å‡º
è®­ç»ƒä¼šåœ¨`policy_learn/checkpoints/`ä¸‹åˆ›å»ºæ—¶é—´æˆ³å‘½åçš„æ–‡ä»¶å¤¹ï¼š
```
policy_learn/checkpoints/feature_mlp_20250821_143022/
â”œâ”€â”€ best_model.pt              # æœ€ä½³æ¨¡å‹æƒé‡
â”œâ”€â”€ checkpoint_epoch_20.pt     # å®šæœŸæ£€æŸ¥ç‚¹
â”œâ”€â”€ checkpoint_epoch_40.pt
â””â”€â”€ wandb/                     # wandbæœ¬åœ°æ–‡ä»¶
```

### wandbä»ªè¡¨æ¿
- **è®­ç»ƒæŒ‡æ ‡**: train/loss, train/l1_error, train/rmse
- **éªŒè¯æŒ‡æ ‡**: val/loss, val/l1_error, val/rmse
- **å­¦ä¹ ç‡**: learning_rate
- **æ¨¡å‹æ–‡ä»¶**: è‡ªåŠ¨ä¸Šä¼ æœ€ä½³æ¨¡å‹

## ğŸ›ï¸ æ¨¡å‹æ¶æ„

```
è¾“å…¥: å·¦å³æ‰‹è§¦è§‰åŠ›æ•°æ® (B, 3, 20, 20) Ã— 2
  â†“
é¢„è®­ç»ƒCNNç¼–ç å™¨ (å†»ç»“)
  â†“
ç‰¹å¾æå–: 128ç»´ Ã— 2 = 256ç»´
  â†“
MLPç½‘ç»œ: 256 â†’ 512 â†’ 512 â†’ 512 â†’ 3
  â†“
è¾“å‡º: 3ç»´ä½ç½®å¢é‡ (dx, dy, dz)
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ•°æ®ç±»åˆ«
```python
'categories': ["cir_lar", "rect_med"]  # åªè®­ç»ƒç‰¹å®šç±»åˆ«
```

### è°ƒæ•´ç½‘ç»œç»“æ„
```python
'hidden_dims': [256, 128, 64]  # æ›´å°çš„ç½‘ç»œ
```

### æ›´æ”¹losså‡½æ•°
```python
'loss': {
    'loss_type': 'mse',    # å¯é€‰: 'huber', 'mse', 'l1'
    'huber_delta': 1.0     # Huber losså‚æ•°
}
```

## ğŸ› å¸¸è§é—®é¢˜

### wandbç™»å½•é—®é¢˜
```bash
# é‡æ–°ç™»å½•
wandb login --relogin

# æ£€æŸ¥ç™»å½•çŠ¶æ€
wandb status
```

### CUDAå†…å­˜ä¸è¶³
```python
# å‡å°æ‰¹æ¬¡å¤§å°
'batch_size': 16  # æˆ–æ›´å°

# å‡å°‘å·¥ä½œè¿›ç¨‹
'num_workers': 2
```

### æ•°æ®è·¯å¾„é”™è¯¯
ç¡®ä¿æ•°æ®è·¯å¾„ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•æ­£ç¡®ï¼š
```python
'data_root': 'datasets/data25.7_aligned'  # ä¸è¦ç”¨ç»å¯¹è·¯å¾„
```

## ğŸ“ˆ ç›‘æ§è®­ç»ƒ

1. **wandbä»ªè¡¨æ¿**: è®¿é—® https://wandb.ai æŸ¥çœ‹å®æ—¶è®­ç»ƒå›¾è¡¨
2. **ç»ˆç«¯è¾“å‡º**: å®æ—¶æŸ¥çœ‹è®­ç»ƒè¿›åº¦å’ŒæŒ‡æ ‡
3. **æœ¬åœ°æ–‡ä»¶**: æ£€æŸ¥ä¿å­˜çš„æ¨¡å‹å’Œæ£€æŸ¥ç‚¹

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å…ˆè¿è¡Œæµ‹è¯•**: ä½¿ç”¨`run_test_training.py`éªŒè¯é…ç½®
2. **ç›‘æ§è¿‡æ‹Ÿåˆ**: å…³æ³¨è®­ç»ƒ/éªŒè¯æŸå¤±å·®è·
3. **è°ƒæ•´å­¦ä¹ ç‡**: æ ¹æ®æŸå¤±æ›²çº¿è°ƒæ•´å­¦ä¹ ç‡è®¡åˆ’
4. **ä¿å­˜å®éªŒ**: ä¸ºæ¯æ¬¡å®éªŒæ·»åŠ æœ‰æ„ä¹‰çš„wandbæ ‡ç­¾å’Œå¤‡æ³¨

## ğŸ‰ å¼€å§‹è®­ç»ƒ

ç¡®ä¿å®Œæˆç¯å¢ƒé…ç½®åï¼Œç›´æ¥è¿è¡Œï¼š
```bash
python run_feature_mlp_training.py
```

ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼š
- âœ… wandbç™»å½•å’Œåˆå§‹åŒ–
- âœ… æ•°æ®é›†åŠ è½½å’Œé¢„å¤„ç†  
- âœ… æ¨¡å‹åˆ›å»ºå’Œé¢„è®­ç»ƒæƒé‡åŠ è½½
- âœ… è®­ç»ƒå¾ªç¯å’ŒéªŒè¯
- âœ… æœ€ä½³æ¨¡å‹ä¿å­˜
- âœ… å®éªŒè·Ÿè¸ªå’Œå¯è§†åŒ–
